---
import { Icon } from 'astro-icon/components';
import { Markdown } from '@astropub/md';

import Profile from '@components/GitHubProfilePicture.svelte';
import { YouTube } from '@astro-community/astro-embed-youtube';

import { Image } from 'astro:assets';
const { slug, title, color, category, proj_url, leaders, goal, slack, intro_video, image, image_alt } = Astro.props;

const images = import.meta.glob('../../assets/**');
export interface Props {
    slug: string;
    title: string;
    color?: string;
    category?: string;
    proj_url?: URL;
    leaders: Object;
    goal?: string;
    slack?: string;
    intro_video?: string;
    image?: string;
    image_alt?: string;
}
const slack_clean = slack ? slack.replace('#', '') : '';
let this_color = color;
if (!color && category) {
    if (category == 'pipelines') this_color = '#377CF6';
    if (category == 'components') this_color = '#D04791';
    if (category == 'tooling') this_color = '#BE831A';
    if (category == 'community') this_color = '#238636';
}
const border_col = this_color ? { 'border-left-color': this_color, 'border-left-width': '5px' } : {};
---

<div class="card mb-1" style={border_col}>
    <div class="card-body d-grid p-0">
        <button type="button" class="btn btn-link text-start p-3" data-bs-toggle="modal" data-bs-target={'#' + slug}>
            {title}
        </button>
    </div>
</div>

<!-- Modal -->
<!-- TODO: Fix hack where disabling backdrop is needed with data-bs-backdrop="false" - move modal to bottom of page HTML? -->
<div
    class="modal fade z-3"
    id={slug}
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
    data-bs-backdrop="false"
>
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">{title}</h1>
                <div>
                    {
                        category && (
                            <span class="small badge rounded-pill ms-2" style={`background-color: ${this_color}`}>
                                {category}
                            </span>
                        )
                    }
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h3>
                    {
                        proj_url && (
                            <a href={proj_url} target="_blank" class="btn btn-small btn-secondary ms-3">
                                <Icon
                                    name="octicon:table-16"
                                    width="12pt"
                                    class="me-1"
                                    style={{ 'margin-top': '-3px' }}
                                />
                                Project Board
                                <Icon
                                    name="octicon:link-external-16"
                                    width="12pt"
                                    class="ms-1"
                                    style={{ 'margin-top': '-3px' }}
                                />
                            </a>
                        )
                    }
                </h3>

                {
                    slack && (
                        <a
                            href={`https://nfcore.slack.com/channels/${slack_clean}`}
                            class="badge rounded-pill text-bg-success text-decoration-none d-inline-flex align-items-center"
                        >
                            <Icon name="mdi:slack" width="12pt" height="10pt" /> Slack:
                            <code class="text-bg-success pb-0">#{slack_clean}</code>
                        </a>
                    )
                }

                <slot />

                {
                    goal && (
                        <>
                            <h4>Goal</h4>
                            <p>
                                <Markdown of={goal} />
                            </p>
                        </>
                    )
                }

                {leaders && <h4>Group Leaders</h4>}
                {
                    leaders && (
                        <div class="d-flex flex-wrap">
                            {Object.entries(leaders).map(([github, { name, slack }]) => (
                                <div class="d-flex align-items-center border rounded rounded-start-0 mb-2">
                                    <Profile name={github} size={50} />
                                    {slack && (
                                        <a href={slack} target="_blank" class="me-2 text-decoration-none">
                                            {name}
                                            <Icon name="mdi:slack" width="14pt" class="mb-1" />
                                        </a>
                                    )}
                                    {!slack && <span class="mx-2">{name}</span>}
                                </div>
                            ))}
                        </div>
                    )
                }
            </div>

            {
                intro_video && (
                    <div class="col-md-6">
                        <YouTube id={intro_video} poster={`https://i.ytimg.com/vi/${intro_video}/hqdefault.jpg`} />
                    </div>
                )
            }
            {
                image && (
                    <div class="col-md-6">
                        <Image src={images['../..' + image]()} alt={image_alt} />
                    </div>
                )
            }
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
        </div>
    </div>
</div>
