---
import Markdown from '@components/Markdown.svelte';
import pipeline_names from '@public/pipeline_names.json';
import PageLayout from '@layouts/PageLayout.astro';
import octokit from '@components/octokit';
import { marked } from 'marked';
export function getStaticPaths() {
    // go through all the pipelines and create a page for each one
    const paths = pipeline_names.pipeline.map((pipeline_name) => {
        return { params: { pipeline: pipeline_name } };
    });
    return paths;
}
const { pipeline } = Astro.params;
const url = 'https://github.com/nf-core/' + pipeline + '/blob/master/README.md';
const readme = await octokit
    .request('GET /repos/{owner}/{repo}/contents/{path}', {
        owner: 'nf-core',
        repo: pipeline,
        path: 'README.md',
    })
    .then((response) => {
        let md_content = Buffer.from(response.data.content, 'base64').toString('utf-8');
        md_content = md_content.substring(md_content.indexOf('# Introduction'));
        return marked.parse(md_content);
    });

var description = 'TODO: fetch description';
---

<PageLayout title={'nf-core/' + pipeline} subtitle={description} md_github_url={url} subfooter={true}>
    <Markdown set:html={readme} />
</PageLayout>
