---
import pipelines_json from '@public/pipelines.json';

export function getStaticPaths() {
    var paths: { params: { pipeline: string; version: string }; props: { releaseSHA: string } }[] = [];
    pipelines_json.remote_workflows.forEach((pipeline) => {
        pipeline.releases.forEach((release) => {
            paths.push({
                params: {
                    pipeline: pipeline.name,
                    version: release.tag_name,
                },
                props: {
                    releaseSHA: release.sha,
                },
            });
        });
    });
    return paths;
}

const { pipeline, version } = Astro.params;
const { releaseSHA } = Astro.props;

if (releaseSHA) {
    const prefix = `${pipeline}/results-${releaseSHA}/`;
    const baseURL = `/${pipeline}/${version}/`;
    return Astro.redirect(baseURL + 'results/' + prefix);
}
---
