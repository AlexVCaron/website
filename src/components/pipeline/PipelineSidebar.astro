---
import InstallCmd from '@components/InstallCmd.svelte';
import SidebarStatsRow from '@components/sidebar/SidebarStatsRow.astro';
import { formatDistance } from 'date-fns';

const { meta, pipeline, version } = Astro.props;

export interface Props {
    meta: {
        contributors: {
            name: string;
            count: number;
        }[];
        open_issues_count: number;
        open_pr_count: number;
        releases: {
            published_at: string;
        }[];
        stargazers_count: number;
        subscribers_count: number;
        updated_at: string;
    };
    pipeline: string;
    version: string;
}
---

<div class="sidebar">
    <SidebarStatsRow content={[{ title: 'run with', icon: 'fa-regular fa-terminal' }]}>
        <ul class="nav nav-fill small" role="tablist">
            <li class="nav-item border-0" role="presentation">
                <a
                    class="nav-link text-reset py-1 active border-secondary btn btn-sm btn-outline-secondary rounded-bottom-0 rounded-end-0"
                    id="nf-core-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#nf-core-tab-pane"
                    type="button"
                    role="tab"
                    aria-controls="nf-core-tab-pane"
                    aria-selected="true">nf-core</a
                >
            </li>
            <li class="nav-item" role="presentation">
                <a
                    class="nav-link text-reset py-1 border-secondary btn btn-sm btn-outline-secondary rounded-0 border border-start-0 border-end-0"
                    id="nextflow-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#nextflow-tab-pane"
                    type="button"
                    role="tab"
                    aria-controls="nextflow-tab-pane"
                    aria-selected="false">Nextflow</a
                >
            </li>
            <li class="nav-item" role="presentation">
                <a
                    class="nav-link text-reset py-1 border-secondary btn btn-sm btn-outline-secondary rounded-bottom-0 rounded-start-0"
                    id="tower-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tower-tab-pane"
                    type="button"
                    role="tab"
                    aria-controls="tower-tab-pane"
                    aria-selected="false">Tower</a
                >
            </li>
        </ul>
        <div class="tab-content pb-2">
            <div
                class="tab-pane show active"
                id="nf-core-tab-pane"
                role="tabpanel"
                aria-labelledby="nf-core-tab"
                tabindex="0"
            >
                <InstallCmd
                    client:idle
                    icon={false}
                    flatTop={true}
                    cmd={`nf-core launch nf-core/${pipeline} -r ${version}`}
                />
            </div>
            <div class="tab-pane" id="nextflow-tab-pane" role="tabpanel" aria-labelledby="nextflow-tab" tabindex="0">
                <InstallCmd
                    client:visible
                    flatTop={true}
                    icon={false}
                    cmd={`nextflow run nf-core/${pipeline} -r ${version} -profile test --outdir <OUTDIR>`}
                />
            </div>
            <div class="tab-pane" id="tower-tab-pane" role="tabpanel" aria-labelledby="tower-tab" tabindex="0">
                <InstallCmd
                    client:visible
                    icon={false}
                    flatTop={true}
                    cmd={`tw launch https://nf-co.re/${pipeline} -r ${version}`}
                />
                <span class="text-body-secondary small"
                    >See the <a href="https://github.com/seqeralabs/tower-cli/#2-configuration" target="_blank">docs</a>
                    on how to configure the Tower CLI.</span
                >
            </div>
        </div>
    </SidebarStatsRow>
    <SidebarStatsRow
        content={[
            { title: 'subscribers', value: meta.subscribers_count },
            { title: 'stars', value: meta.stargazers_count },
        ]}
    />
    <SidebarStatsRow
        content={[
            { title: 'open issues', value: meta.open_issues_count },
            { title: 'open PRs', value: meta.open_pr_count },
        ]}
    />
    <SidebarStatsRow
        content={[
            {
                title: 'last release',
                value: formatDistance(new Date(meta.releases[0].published_at), new Date(), {
                    addSuffix: true,
                }),
            },
            {
                title: 'last update',
                value: formatDistance(new Date(meta.updated_at), new Date(), { addSuffix: true }),
            },
        ]}
    />
    <SidebarStatsRow content={[{ title: 'contributors' }]}>
        {
            meta.contributors.map((contributor) => {
                return (
                    <img
                        src={'https://github.com/' + contributor.name + '.png?size=50'}
                        alt={contributor.name}
                        class="me-2 mb-2"
                        width="50"
                        height="50"
                        data-bs-toggle="tooltip"
                        title={
                            contributor.name +
                            '\n (' +
                            contributor.count +
                            (contributor.count > 1 ? ' contributions)' : ' contribution)')
                        }
                    />
                );
            })
        }
    </SidebarStatsRow>
</div>
<style lang="scss">
    @import '@styles/_variables.scss';
    .nav-link.btn {
        margin-bottom: -1pt;
    }
    .nav-link.btn {
        &.active,
        &:hover,
        &:focus {
            color: $white !important;
        }
    }
    :global([data-bs-theme='dark']) {
        .border-secondary {
            border-color: $gray-700 !important;
        }
        .nav-link.btn {
            &.active,
            &:hover,
            &:focus {
                background-color: $gray-700;
            }
        }
    }
</style>
